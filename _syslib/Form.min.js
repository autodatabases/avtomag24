function WarForm(t,e){this.formName=t,e||(e={}),this.useHtml5=e.useHtml5,this.checkAll=e.checkAll,this.checkOnChange=e.checkOnChange||!0,this.failedClass=e.failedClass||"validation-failed",this.successClass=e.successClass||"validation-passed",this.validationPropertyName=e.validationPropertyName||"data-validator-properties",this.matchFieldClass=e.matchFieldClass||"required",this.customValidate=e.customValidate,this.messages=e.messages,this.humanCheckHref=e.humanCheckHref,this.useAsyncValidator=!0,this.submitMode=!0;var i=document.createEvent("Event");i.initEvent("formFieldFail",!0,!0),this.events={fieldFail:i},this.form=null,this.validators=[],this.controls=[],this.validateFields=[],this.ajaxCheckLoading=!1}WarForm.prototype.init=function(){if(this.form=document.querySelector("[name="+this.formName+"]"),this.form){var t=this;if(this.form){this.form.addEventListener("submit",function(e){if(t.submitMode=!0,!t.validate(this))return e.preventDefault(),e.stopImmediatePropagation(),!1;if("_self"==this.target||""==this.target||"content_frame"==this.target){var i=t.form.querySelectorAll("[type=submit], .submitButton, button");setTimeout(function(){for(var t=0;t<i.length;t++)i[t].disabled=!0},0)}});var e=this.getRequiredFields(),i=!1;if(e.length>0){var s=0;for(s=0;s<e.length;s++)t.initField(e[s]);if(this.checkOnChange)for(s=0;s<e.length;s++)"reg_hc_code"===e[s].name&&(i=!0),e[s].addEventListener("change",function(e){t.submitMode=!1;var i=t.validateField(this);i.fail?t.onElementFail(this,i.msg):t.onElementSucces(this)})}if(this.humanCheckHref&&i){var a=this.form.querySelectorAll("input");for(s=0;s<a.length;s++)a[s].addEventListener("focus",function(e){for(var i=document.querySelectorAll("img.HumanCheck"),s=0;s<i.length;s++)""==i[s].getAttribute("src")&&(i[s].setAttribute("src",t.humanCheckHref),t.initRefreshCaptcha(i[s],t.humanCheckHref))})}this.initValidators(),this.initCustom()}}},WarForm.prototype.initField=function(t){var e=jqWar(t).parents(".form-gr__control");t.classList.contains(this.matchFieldClass)&&e.length>0&&e.addClass("form-gr__control--required")},WarForm.prototype.initCustom=function(){},WarForm.prototype.getRequiredFields=function(){return this.form.querySelectorAll("."+this.matchFieldClass)},WarForm.prototype.getVisibleFields=function(){for(var t=[],e=this.form.querySelectorAll("."+this.matchFieldClass),i=0;i<e.length;i++){if("checkbox"===e[i].type){var s=e[i].nextSibling;if(s&&"LABEL"===s.tagName&&0===s.offsetWidth)continue}else if(0===e[i].offsetWidth)continue;t.push(e[i])}return t},WarForm.prototype.checkNodeNameValidate=function(t){return"INPUT"===t||"SELECT"===t||"TEXTAREA"===t},WarForm.prototype.validate=function(t){for(var e=this.getVisibleFields(),i=!0,s=0;s<e.length;s++)if(this.checkNodeNameValidate(e[s].nodeName)){var a=this.validateField(e[s]);if(i=!a.fail,a.fail){if(this.onElementFail(e[s],a.msg),!this.checkAll)break}else this.onElementSucces(e[s])}return(!i||!this.customValidate||!1!==this.customValidate(t))&&i},WarForm.prototype.validateField=function(t){for(var e=!1,i=!1,s=0;s<t.classList.length;s++)if(this.validators[t.classList[s]]&&(e=!this.validators[t.classList[s]].test(t))){i=this.messages[t.classList[s]];break}return{msg:i,fail:e}},WarForm.prototype.getElementProperties=function(t){var e=null,i=t.getAttribute(this.validationPropertyName);return i&&(e=JSON.parse(i)),e},WarForm.prototype.onElementFail=function(t,e){this.ajaxCheckLoading||(t.classList.add(this.failedClass),t.classList.remove(this.successClass),t.dispatchEvent(this.events.fieldFail),t.focus(),this.offsetHeaderPanel(),this.controls[t.name]&&this.controls[t.name].__proto__.onElementFail&&this.controls[t.name].onElementFail())},WarForm.prototype.offsetHeaderPanel=function(){const t=document.querySelector(".header-catalog__panel");if(t&&t.classList.contains("header-catalog__panel--fixed")){var e=t.clientHeight;e>0&&window.scrollBy(0,"-"+e)}},WarForm.prototype.onElementSucces=function(t){t.classList.remove(this.failedClass),t.classList.add(this.successClass),this.controls[t.name]&&this.controls[t.name].__proto__.onElementSuccess&&this.controls[t.name].onElementSuccess()},WarForm.prototype.initValidators=function(){var t=this;this.validators={},this.validators.IsEmpty={test:function(t){return"select-one"==t.type||"select"==t.type?!(t.selectedIndex>=0&&""!=t.options[t.selectedIndex].value):"checkbox"===t.type?!t.checked:""==t.value.trim()}},this.validators.confirmPassword={test:function(t){var e=document.querySelector("[name="+t.name.substr(0,t.name.indexOf("_repeat"))+"]");return!!e&&e.value==t.value}},this.validators.required={test:function(e){return!t.validators.IsEmpty.test(e)}},this.validators.digitAndNot={test:function(t){return/^(.*[a-z].*)$/i.test(t.value)&&/^(.*[0-9].*)$/i.test(t.value)}},this.validators["validate-integer"]={test:function(e){return t.validators.IsEmpty.test(e)||/^(-?[1-9]\d*|0)$/.test(e.value)}},this.validators["validate-numeric"]={test:function(e){return t.validators.IsEmpty.test(e)||/^-?(?:0$0(?=\d*\.)|[1-9]|0)\d*(\.\d+)?$/.test(e.value)}},this.validators["validate-digits"]={test:function(e){return t.validators.IsEmpty.test(e)||/^[\d() .:\-\+#]+$/.test(e.value)}},this.validators["validate-alpha"]={test:function(e){return t.validators.IsEmpty.test(e)||/^[a-zA-Z]+$/.test(e.value)}},this.validators["validate-alphanum"]={test:function(e){return t.validators.IsEmpty.test(e)||!/\W/.test(e.value)}},this.validators["validate-userlogin"]={test:function(e){return t.validators.IsEmpty.test(e)||/^[a-zа-я0-9\.\-_;:\[\]\\!#$%&'*+\/=?^`{|}~@]+$/i.test(e.value)}},this.validators["validate-email"]={test:function(e){return t.validators.IsEmpty.test(e)||/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]\.?){0,63}[a-z0-9!#$%&'*+\/=?^_`{|}~-]@(?:(?:[a-zа-я0-9](?:[a-zа-я0-9-]{0,61}[a-zа-я0-9])?\.)*[a-zа-я0-9](?:[a-zа-я0-9-]{0,61}[a-zа-я0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\])\.[a-zа-я]{2,}$/i.test(e.value)}},this.validators["validate-emails"]={test:function(e){return t.validators.IsEmpty.test(e)||/^((?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]\.?){0,63}[a-z0-9!#$%&'*+\/=?^_`{|}~-]@(?:(?:[a-zа-я0-9](?:[a-zа-я0-9-]{0,61}[a-zа-я0-9])?\.)*[a-zа-я0-9](?:[a-zа-я0-9-]{0,61}[a-zа-я0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\])\.[a-zа-я]{2,} *)+$/i.test(e.value)}},this.validators["validate-url"]={test:function(e){return t.validators.IsEmpty.test(e)||/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(e.value)}},this.validators["validate-currency-dollar"]={test:function(e){return t.validators.IsEmpty.test(e)||/^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(e.value)}},this.validators.checkEmailDB={test:function(e){return!t.validators.IsEmpty.test(e)&&t.ajaxCheck(e,"checkEmailDB")}},this.validators.checkUserDB={test:function(e){return!t.validators.IsEmpty.test(e)&&t.ajaxCheck(e,"checkUserDB")}},this.validators.checkContactPhoneDB={test:function(e){return!t.validators.IsEmpty.test(e)&&t.ajaxCheck(e,"checkContactPhoneDB")}},this.validators.length={test:function(e){var i=t.getElementProperties(e);return null===i||!i.length||(e.value.length==i.length||0==e.value.length)}},this.validators.minLength={test:function(e){var i=t.getElementProperties(e);return null===i||!i.minLength||e.value.length>=(i.minLength||0)}},this.validators.maxLength={test:function(e){var i=t.getElementProperties(e);return null===i||!i.maxLength||e.value.length<=(i.maxLength||1e4)}}},WarForm.prototype.ajaxCheck=function(t,e){var i=this,s=this.useAsyncValidator;if(this.submitMode){if(this.validateFields[e])return!0;s=!1}this.validateFields[e]=!1;var a=new XMLHttpRequest;if(a.open("GET","/ajax_validator.html?type="+encodeURIComponent(e)+"&value="+encodeURIComponent(t.value),s),a.send(),s)i.ajaxCheckLoading=!0,a.onreadystatechange=function(){4==a.readyState&&200==a.status&&(i.ajaxCheckLoading=!1,""!=a.responseText&&(1==JSON.parse(a.responseText).find?i.onElementFail(t,i.messages[e]):(i.validateFields[e]=!0,i.onElementSucces(t))))};else if(4==a.readyState&&200==a.status&&""!=a.responseText&&1!=JSON.parse(a.responseText).find)return i.validateFields[e]=!0,!0;return!1},WarForm.prototype.initRefreshCaptcha=function(t,e){!function(t,e){this.init=function(t){this.img=t,this.link=e,this.container=document.createElement("div"),this.button=document.createElement("button"),this.button.type="button",this.button.classList.add("refresh-captcha__button"),this.container.classList.add("refresh-captcha"),this.img.classList.add("refresh-captcha__img"),this.img.parentNode.appendChild(this.container),this.container.appendChild(this.img),this.container.appendChild(this.button);var i=this;this.button.addEventListener("click",function(t){t.preventDefault(),i.refresh()})},this.refresh=function(){this.img.src=this.link+"?"+(new Date).getTime()},this.init(t,e)}(t,e)},WarForm.prototype.addControl=function(t,e){e.formName=this.formName,this.controls[t]=e},WarForm.prototype.submit=function(){this.validate(this.form)&&this.form.submit()};